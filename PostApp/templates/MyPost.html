{% extends "homepage.html" %}
{% load static %}
{% block content %}
<!-- Feed -->
<div class="feed">
     {% csrf_token %}
    <!-- Dummy Post 1 -->
     {% for post in posts %}
    <div class="post-card">
        <div class="post-header">
            {% if profile.profile_image %}
                <img src="{{ profile.profile_image.url }}" class="post-profile" alt="User">
            {% else %}
                <img src="{% static 'ExtraImage/images.jpg' %}" class="post-profile" alt="User">
            {% endif %}
            <span>{{post.user}}</span>
            {% if request.user != post.user %}
                <form method="post" action="{% url 'follow' post.user.id %}">
                    {% csrf_token %}

                    {% if post.user.id in following_users %}
                        <button type="submit" class="follow-btn">Following</button>
                    {% else %}
                        <button type="submit" class="follow-btn">Follow</button>
                    {% endif %}
                </form>
            {%else%}
              <div class="post-menu">
                  <button type="button" class="menu-toggle">
                      <i class="fa-solid fa-ellipsis-vertical"></i>  {# 3 dots icon #}
                  </button>

                  <div class="menu-dropdown">
                      <a href="{% url 'post_update' post.id %}" class="menu-item">Update</a>

                      <form method="post" action="{% url 'post_delete' post.id %}">
                          {% csrf_token %}
                          <button type="button"
                                class="menu-item delete-btn"
                                data-delete-url="{% url 'post_delete' post.id %}">
                            Delete
                          </button>
                      </form>

                      <button type="button" class="menu-item menu-cancel">
                          Cancel
                      </button>
                  </div>
              </div>
            {%endif%}
        </div>
        <img class="post-image" src="{{post.image_url.url}}" alt="Post">
        <div class="post-actions">
            <label class="like-wrapper">
                <input type="checkbox" class="like-checkbox"
                 data-id="{{ post.id }}"
                 {% if post.id in user_likes %}checked{% endif %}>
                <i class="fa-solid fa-heart like-icon"></i>
            </label>
            <span id="like-count-{{ post.id }}">{{ post.total_likes }}</span>
            <button class="comment-btn"
                    data-id="{{ post.id }}"
                    data-comments-url="{% url 'get_comments' post.id %}">
                <i class="fa-regular fa-comment"></i>
            </button>

            <span id="comment-count-{{ post.id }}">{{ post.total_comments }}</span>
        </div>
        <div class="post-caption">
            {{post.caption}}
        </div>
    </div>
    {% empty %}
      <p class="no-posts"><h1>No posts yet</h1></p>
    {%endfor%}

</div>
<!-- Comment Popup Modal -->
<div class="comment-modal" id="commentModal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>

    <div class="modal-left">
      <img id="modalPostImage" src="" alt="Post Image">
    </div>

    <div class="modal-right">
      <div class="modal-header">
        <img src="{% static 'ExtraImage/loginImage2.jpg' %}" alt="User" class="modal-user-profile">
        <span class="modal-username" id="modalUsername"></span>
      </div>

      <div class="modal-comments" id="modalComments">
        <!-- comments yaha JS se load honge -->
      </div>

      <form class="comment-form" id="commentForm">
        {% csrf_token %}
        <input type="hidden" id="commentPostId">
        <input type="text" placeholder="Add a comment..." id="commentInput">
        <button type="submit" id="postCommentBtn">Post</button>
      </form>
    </div>
  </div>
</div>

<div id="deleteModal" class="delete-modal">
  <div class="delete-box">
    <h4>Delete Post?</h4>
    <p>Are you sure you want to delete this post?</p>

    <form id="deleteConfirmForm" method="post">
      {% csrf_token %}
      <button type="submit" class="confirm-delete">Delete</button>
      <button type="button" id="cancelDelete" class="cancel-delete">Cancel</button>
    </form>
  </div>
</div>
{% endblock %}
